<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Shuffle & Crossfade Player</title>
<style>
  html, body {
    height: 100%;
  }
  body {
    margin: 0;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;
    background: url("video.gif") no-repeat center center fixed;
    background-size: cover;
    font-family: Arial, sans-serif;
    color: white;
    text-shadow: 1px 1px 3px black;
  }

  h2 { margin-bottom: 10px; }

  #nowPlaying {
    margin-bottom: 10px;
    font-size: 20px;
    font-weight: bold;
  }

  #progressBar, #volumeBar {
    width: 320px;
    margin-bottom: 12px;
  }

  .controls {
    display: flex;
    gap: 15px;
    align-items: center;
    margin-bottom: 12px;
  }

  button {
    padding: 10px 16px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    background-color: rgba(0,0,0,0.6);
    color: white;
    transition: background 0.2s;
  }
  button:hover { background-color: rgba(255,255,255,0.12); }

  .player {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    padding: 18px;
    background-color: rgba(0,0,0,0.25);
    border-radius: 12px;
  }
</style>
</head>
<body>
  <div class="player">

    <!-- üé® ARTWORK -->
    <img id="artwork" src="cover1.jpg"
         style="width: 260px; height: 260px; border-radius: 12px; object-fit: cover; margin-bottom: 12px;">

    <h2>Shuffle & Crossfade Player</h2>
    <div id="nowPlaying">Now Playing: ‚Äì</div>

    <input type="range" id="progressBar" min="0" max="100" value="0">

    <!-- Volume Slider -->
    <label>Volume</label>
    <input type="range" id="volumeBar" min="0" max="100" value="100">

    <div class="controls">
      <button onclick="prevTrack()">‚èÆ Back</button>
      <button id="playPauseBtn" onclick="togglePlayPause()">‚ñ∂ Play</button>
      <button onclick="nextTrack()">‚è≠ Skip</button>
      <button id="shuffleBtn" onclick="toggleShuffle()">üîÅ Shuffle Off</button>
    </div>
  </div>

<script>
/* ------------- playlist ------------- */
const tracks = [
  "Moment of Peace.wav",
  "The Road is Full of Opportunities.wav",
  "A Battle is Brewing.wav",
  "Victory is Sweet When Sunny.wav",
  "Sale! Sale! Sale!.wav",
  "Defeat Stings When it Rains.wav",
  "Unreedemable Evil.wav"
];

/* ------------- ARTWORK LIST (same order as tracks) ------------- */
const artwork = [
  "AlbumCovers/Moment of Peace.png",
  "AlbumCovers/The Road is Full of Opportunities.png",
  "AlbumCovers/A Battle is Brewing.png",
  "AlbumCovers/Victory is Sweet When Sunny.png",
  "AlbumCovers/Sale! Sale! Sale!.png",
  "AlbumCovers/Defeat Stings When it Rains.png",
  "AlbumCovers/Unreedemable Evil.png"
];

/* ------------- audio objects and state ------------- */
let audio1 = new Audio();
let audio2 = new Audio();
let current = audio1;
let next = audio2;

let currentIndex = 0;
let isPlaying = false;
let isFading = false;
let shuffle = false;

const progressBar = document.getElementById('progressBar');
const volumeBar = document.getElementById('volumeBar');
const playPauseBtn = document.getElementById('playPauseBtn');
const shuffleBtn = document.getElementById('shuffleBtn');
const artworkImg = document.getElementById('artwork');

current.src = tracks[currentIndex];
current.volume = 1;
updateNowPlaying();

/* ---------- clean name ---------- */
function cleanName(filename) {
  return filename.split('/').pop().replace(/\.[^/.]+$/, "");
}

/* ---------- update track title AND artwork ---------- */
function updateNowPlaying() {
  document.getElementById("nowPlaying").innerText =
    "Now Playing: " + cleanName(tracks[currentIndex]);

  // üé® Set artwork for current track
  artworkImg.src = artwork[currentIndex];
}

/* ---------- timeupdate ---------- */
function onTimeUpdate() {
  if (this !== current) return;
  if (current.duration && !isNaN(current.duration)) {
    progressBar.value = (current.currentTime / current.duration) * 100;
    if (!isFading && (current.duration - current.currentTime) <= 6) {
      current.removeEventListener('timeupdate', onTimeUpdate);
      nextTrack();
    }
  }
}

function attachCurrentWatchers() {
  current.removeEventListener('timeupdate', onTimeUpdate);
  current.addEventListener('timeupdate', onTimeUpdate);
}

function detachWatchersFrom(elem) {
  elem.removeEventListener('timeupdate', onTimeUpdate);
}

/* ---------- shuffle ---------- */
function toggleShuffle() {
  shuffle = !shuffle;
  shuffleBtn.innerText = shuffle ? "üîÄ Shuffle On" : "üîÅ Shuffle Off";
}

/* ---------- crossfade ---------- */
function crossfadeTo(index) {
  if (isFading) return;
  isFading = true;

  detachWatchersFrom(current);
  detachWatchersFrom(next);

  next.src = tracks[index];
  next.volume = 0;
  next.play().catch(()=>{});

  isPlaying = true;
  playPauseBtn.innerText = "‚è∏ Pause";

  const fadeSteps = 60;
  let step = 0;

  const fadeTimer = setInterval(() => {
    step++;
    const t = step / fadeSteps;
    current.volume = Math.max(0, 1 - t);
    next.volume = Math.min(1, t);

    if (step >= fadeSteps) {
      clearInterval(fadeTimer);
      current.pause();

      [current, next] = [next, current];
      currentIndex = index;
      updateNowPlaying();

      attachCurrentWatchers();
      isFading = false;
    }
  }, 100);
}

/* ---------- next / prev ---------- */
function nextTrack() {
  let newIndex;

  if (shuffle) {
    do {
      newIndex = Math.floor(Math.random() * tracks.length);
    } while (newIndex === currentIndex);
  } else {
    newIndex = (currentIndex + 1) % tracks.length;
  }

  crossfadeTo(newIndex);
}

function prevTrack() {
  const newIndex = (currentIndex - 1 + tracks.length) % tracks.length;
  crossfadeTo(newIndex);
}

/* ---------- play / pause ---------- */
function togglePlayPause() {
  if (isPlaying) {
    current.pause();
    isPlaying = false;
    playPauseBtn.innerText = "‚ñ∂ Play";
  } else {
    current.play().catch(()=>{});
    isPlaying = true;
    playPauseBtn.innerText = "‚è∏ Pause";
    attachCurrentWatchers();
  }
}

/* ---------- progress seek ---------- */
progressBar.addEventListener('input', () => {
  if (current.duration) {
    current.currentTime = (progressBar.value / 100) * current.duration;
  }
});

/* ---------- volume ---------- */
volumeBar.addEventListener('input', () => {
  const vol = volumeBar.value / 100;
  current.volume = vol;
  next.volume = vol;
});

attachCurrentWatchers();

</script>
</body>
</html>
